apply plugin: "com.github.johnrengelman.shadow"

dependencies {
    compile project(':stroom-connectors')

    compile group: 'org.apache.kafka', name:'kafka-clients', version:'0.10.0.1' //CDH5.10 uses kafka 10.0, Kafka <10.2 is picky about client and server versions.

    compile libs.guava
    compile libs.slf4j_api

    testCompile libs.junit
    testCompile libs.mockito_core
}

def fatJarName = "stroom-kafka-client-impl_0_10_0_1-all.jar"

shadowJar {
    // Allows us to build fat jars with lots of files
    zip64 true
    archiveName fatJarName
}

task copyPluginJar(type: Copy) {
    dependsOn shadowJar

    def jarName =  "${project.buildDir}/libs/${fatJarName}"
    doFirst {
        new File(stroomPluginsDir).mkdirs()
        //logger.info "Copying $jarName to $stroomPluginsDir"
        println "Copying plugin jar $jarName to $stroomPluginsDir"
    }

    from jarName
    into stroomPluginsDir
}

//if we are running the app in an IDE we want this jar in place for stroom to pick up
tasks.build.dependsOn copyPluginJar

