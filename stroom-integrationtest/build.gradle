ext.moduleName = 'stroom.integrationtest'

dependencies {
    testImplementation project(':stroom-app')
    // Use default DB config.
    testImplementation project(':stroom-activity:stroom-activity-api')
    testImplementation project(':stroom-activity:stroom-activity-impl-mock')
    testImplementation project(':stroom-config:stroom-config-app')
    testImplementation project(':stroom-core-server')
    testImplementation project(':stroom-core-shared')
    testImplementation project(':stroom-docstore:stroom-docstore-impl')
    testImplementation project(':stroom-docstore:stroom-docstore-shared')
    testImplementation project(':stroom-dashboard:stroom-dashboard-server')
    testImplementation project(':stroom-dashboard:stroom-dashboard-shared')
    testImplementation project(':stroom-data-meta:stroom-data-meta-api')
    testImplementation project(':stroom-data-meta:stroom-data-meta-impl-db')
    testImplementation project(':stroom-data-meta:stroom-data-meta-impl-mock')
    testImplementation project(':stroom-data-store:stroom-data-store-api')
    testImplementation project(':stroom-data-store:stroom-data-store-impl-fs')
    testImplementation project(':stroom-data-store:stroom-data-store-impl-mock')
    testImplementation project(':stroom-elastic:stroom-elastic-impl')
    testImplementation project(':stroom-entity-shared')
    testImplementation project(':stroom-event-logging:stroom-event-logging-api')
    testImplementation project(':stroom-event-logging:stroom-event-logging-impl')
    testImplementation project(':stroom-explorer:stroom-explorer-api')
    testImplementation project(':stroom-explorer:stroom-explorer-impl')
    testImplementation project(':stroom-explorer:stroom-explorer-impl-db')
    testImplementation project(':stroom-headless')
    testImplementation project(':stroom-importexport:stroom-importexport-api')
    testImplementation project(':stroom-index:stroom-index-server')
    testImplementation project(':stroom-index:stroom-index-shared')
    testImplementation project(':stroom-pipeline')
    testImplementation project(':stroom-ruleset:stroom-ruleset-server')
    testImplementation project(':stroom-security:stroom-security-api')
    testImplementation project(':stroom-security:stroom-security-impl-mock')
    testImplementation project(':stroom-security:stroom-security-server')
    testImplementation project(':stroom-security:stroom-security-shared')
    testImplementation project(':stroom-statistics:stroom-statistics-api')
    testImplementation project(':stroom-statistics:stroom-statistics-server')
    testImplementation project(':stroom-statistics:stroom-statistics-shared')
    testImplementation project(':stroom-task:stroom-task-api')
    testImplementation project(':stroom-test-common')
    testImplementation project(':stroom-util')
    testImplementation project(':stroom-util-shared')

//    testImplementation project(path: ':stroom-core-server', configuration: 'testArtifacts')
//    testImplementation project(path: ':stroom-dashboard:stroom-dashboard-server', configuration: 'testArtifacts')
//    testImplementation project(path: ':stroom-index:stroom-index-server', configuration: 'testArtifacts')
//    testImplementation project(path: ':stroom-pipeline', configuration: 'testArtifacts')
//    testImplementation project(path: ':stroom-security:stroom-security-server', configuration: 'testArtifacts')
    testImplementation project(':stroom-test-common')

    testImplementation libs.stroomQueryApi
    testImplementation libs.stroomQueryCommon

    testImplementation libs.commons_io
    testImplementation libs.fast_classpath_scanner
    testImplementation libs.guice4
    testImplementation libs.hibernate_core
    testImplementation libs.hibernate_jpa_api
    testImplementation libs.hikari
    testImplementation libs.junit_jupiter_api
    testImplementation libs.lucene_core
    testImplementation libs.saxon_he
    testImplementation libs.slf4j_api
    testImplementation libs.vavr

    testRuntimeOnly libs.javax_el
    //the following logging libs are needed when running junits outside dropwizard
    testRuntimeOnly libs.jcl_over_slf4j
    testRuntimeOnly libs.jul_to_slf4j
    testRuntimeOnly libs.log4j_over_slf4j
    testRuntimeOnly libs.logback_classic
    testRuntimeOnly libs.logback_core
    testRuntimeOnly libs.jaxb_runtime
    testRuntimeOnly libs.javax_activation

    testImplementation libs.mockito_core
    testImplementation libs.assertj_core
    testImplementation libs.dropwizard_testing
    testImplementation libs.dropwizard_client

    // The following logging libs are needed when running junits outside dropwizard
    testRuntimeOnly libs.javax_activation
    testRuntimeOnly libs.jaxb_runtime
    testRuntimeOnly libs.jcl_over_slf4j
    testRuntimeOnly libs.jul_to_slf4j
    testRuntimeOnly libs.junit_jupiter_engine
    testRuntimeOnly libs.log4j_over_slf4j
    testRuntimeOnly libs.logback_classic
    testRuntimeOnly libs.logback_core
}

task setupSampleDataApplication(type: JavaExec) {
    dependsOn this:compileJava
    dependsOn this:compileTestJava
    // We need to set the working directory as the stroom root otherwise
    // setupSampleData won't find 'samples' directories in other modules.
    workingDir '../'
    classpath = sourceSets.test.runtimeClasspath
    main = 'stroom.test.SetupSampleData'
}

////TODO This specific dep is needed to ensure TestKafkaExternalLoader has the jar available
////for its test. This is a TODO as stroom-connectors needs a big refactor once we
////decide what we are doing with plugable client libs and pipeline elements.
//tasks.integrationTest.dependsOn ':stroom-kafka:stroom-kafka-client-impl_0_10_0_1:copyPluginJar'
