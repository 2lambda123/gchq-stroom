apply plugin: 'com.github.johnrengelman.shadow'

ext.moduleName = 'stroom.elastic.impl.http'

dependencies {
    compile project(':stroom-elastic:stroom-elastic-api')
    compile project(':stroom-elastic:stroom-elastic-impl')

    compile libs.slf4j_api
    compile libs.jackson_databind

    testCompile libs.junit
}

def fatJarName = "stroom-elastic-impl-http.jar"

//shadowJar {
//    // Allows us to build fat jars with lots of files
//    zip64 true
//    archiveName fatJarName
//
//    relocate 'org.apache.lucene', 'stroom.org.apache.lucene'
//}

task copyPluginJar(type: Copy) {
//    dependsOn shadowJar

    def jarName =  "${project.buildDir}/libs/${fatJarName}"
    doFirst {
        new File(stroomPluginsDir).mkdirs()
        //logger.info "Copying $jarName to $stroomPluginsDir"
        println "Copying plugin jar $jarName to $stroomPluginsDir"
    }

    from jarName
    into stroomPluginsDir
}

//if we are running the app in an IDE we want this jar in place for stroom to pick up
tasks.build.dependsOn copyPluginJar

